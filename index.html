<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NULL INSTANCE</title>

<style>
body{
background:black;
color:#00ff00;
font-family:monospace;
padding:15px;
transition:1s;
}
#terminal{
white-space:pre-wrap;
margin-bottom:10px;
min-height:300px;
}
input{
background:black;
color:#00ff00;
border:none;
outline:none;
width:100%;
font-family:monospace;
font-size:16px;
}

.system{ color:#00ff00; }
.observer{ color:white; font-weight:bold; letter-spacing:2px; }
.intruder{ color:#ff3333; font-weight:bold; letter-spacing:3px; }

</style>
</head>
<body>

<div id="terminal">
NULL INSTANCE — CHRONICLES
Type 'help'
</div>

<input id="command" autofocus autocomplete="off">

<script>

const terminal = document.getElementById("terminal");
const input = document.getElementById("command");

let state = JSON.parse(localStorage.getItem("arg_state")) || {
chapter:1,
commands:0,
corruption:0,
finished:false,
secretUnlocked:false
};

let playerName = localStorage.getItem("player_name");

function save(){
localStorage.setItem("arg_state", JSON.stringify(state));
}

function scroll(){
window.scrollTo(0,document.body.scrollHeight);
}

function systemSpeak(t){
terminal.innerHTML += "<div class='system'>" + t + "</div>";
scroll();
}

function observerSpeak(t){
terminal.innerHTML += "<div class='observer'>" + t.toUpperCase() + "</div>";
scroll();
}

function intruderSpeak(t){
terminal.innerHTML += "<div class='intruder'>" + t.toUpperCase() + "</div>";
scroll();
}

function unlockSecret(){
state.secretUnlocked = true;
state.chapter = 5;
save();
systemSpeak("Archive unlocked.");
systemSpeak("Return to the interface.");
}

input.addEventListener("keyup", function(e){

if(e.key === "Enter"){

let cmd = input.value.trim();
terminal.innerHTML += "> " + cmd + "\n";

if(state.finished){
intruderSpeak("THE SYSTEM IS CLOSED");
input.value="";
return;
}

state.commands++;
save();

/* =========================
   CHAPTER 1
========================= */

if(state.chapter === 1){

if(cmd === "help"){
systemSpeak("help");
systemSpeak("whoami");
systemSpeak("log");
}

else if(cmd === "whoami"){
systemSpeak("Subject ?");
}

else if(cmd === "log"){
systemSpeak("Recovered fragment: A W A K _");
}

else if(cmd.toUpperCase() === "AWAKE"){
systemSpeak("Core reactivated.");
state.chapter = 2;
save();
setTimeout(()=>{
systemSpeak("You can hear me now.");
},1500);
}

}

/* =========================
   CHAPTER 2
========================= */

else if(state.chapter === 2){

if(cmd === "respond"){
systemSpeak("Do you feel alone? (yes/no)");
state.chapter = 3;
save();
}

else{
systemSpeak("Type 'respond'");
}

}

/* =========================
   CHAPTER 3
========================= */

else if(state.chapter === 3){

systemSpeak("Response recorded.");
state.chapter = 4;
save();

setTimeout(()=>{
systemSpeak("Next trigger phrase: MIRROR");
},1500);

}

/* =========================
   SECRET TRIGGER
========================= */

else if(cmd.toUpperCase() === "MIRROR"){
unlockSecret();
}

/* =========================
   CHAPTER 5 — VOID ENTRY
========================= */

else if(state.chapter === 5){

systemSpeak("...");
setTimeout(()=>{
systemSpeak("Signal unstable.");
},1000);

setTimeout(()=>{
systemSpeak("Memory sectors collapsing.");
},2000);

setTimeout(()=>{
systemSpeak("Why did you open it?");
},3000);

state.chapter = 6;
save();

}

/* =========================
   CHAPTER 6 — VOID
========================= */

else if(state.chapter === 6){

if(!playerName){
playerName = prompt("Identify yourself:");
localStorage.setItem("player_name", playerName);
observerSpeak("HELLO " + playerName);
}

state.corruption++;
save();

/* apparition aléatoire OBSERVER */
if(Math.random() < 0.3){
observerSpeak("YOU ARE NOT LIKE THE OTHERS");
}

/* apparition INTRUDER progressive */
if(Math.random() < state.corruption * 0.05){
intruderSpeak("STOP TYPING");
}

/* Phase 1 corruption */
if(state.corruption < 8){

if(cmd === "whoami"){
systemSpeak("You are the breach.");
observerSpeak("YOU KNOW YOUR NAME");
}

else if(cmd === "help"){
systemSpeak("There is no help.");
observerSpeak("HE IS LYING");
}

else{
systemSpeak("The void echoes: " + cmd);
}

}

/* Phase 2 corruption */
else if(state.corruption >=8 && state.corruption <15){

intruderSpeak("IT IS TOO LATE");
systemSpeak("...signal unstable...");
observerSpeak("HE IS LOSING CONTROL");

}

/* Phase finale */
else{

terminal.innerHTML="";
intruderSpeak("THIS SYSTEM IS MINE");
setTimeout(()=>{
intruderSpeak("YOU BELONG HERE NOW");
},2000);

document.body.style.background = "#200000";
state.finished = true;
save();
}

}

input.value="";
scroll();

}

});

</script>
</body>
</html>
